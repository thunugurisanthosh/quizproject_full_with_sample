{% extends "base.html" %}
{% block title %}Take {{ quiz.title }}{% endblock %}
{% block content %}
<h3>{{ quiz.title }}</h3>
<p id="timer" class="text-danger fw-bold">Time left: <span id="time">{{ quiz.time_limit }}:00</span></p>

<form id="quiz-form" method="post">
  {% csrf_token %}
  {% for q in questions %}
    <div class="mb-4 p-3 border rounded shadow-sm">
      <p><strong>Q{{ forloop.counter }}. {{ q.text }}</strong></p>
      {% for c in q.choices.all %}
        <div class="form-check">
          <input class="form-check-input" type="radio" name="question_{{ q.id }}" id="choice_{{ c.id }}" value="{{ c.id }}">
          <label class="form-check-label" for="choice_{{ c.id }}">{{ c.text }}</label>
        </div>
      {% endfor %}
    </div>
  {% endfor %}
  <button type="submit" class="btn btn-primary">Submit Quiz</button>
</form>

<script>
let timeLeft = {{ quiz.time_limit }} * 60;
const timeEl = document.getElementById('time');
function format(t){ let m=Math.floor(t/60).toString().padStart(2,'0'); let s=(t%60).toString().padStart(2,'0'); return `${m}:${s}`; }
timeEl.textContent = format(timeLeft);
const interval = setInterval(() => {
  timeLeft--;
  timeEl.textContent = format(timeLeft);
  if(timeLeft <= 0){ clearInterval(interval); document.getElementById('quiz-form').submit(); }
},1000);
</script>
{% endblock %}
